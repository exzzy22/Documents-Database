@inject IDocumentService _documentService

<EditForm Model="@DocumentModel" OnValidSubmit="@Update">
<div style="width: 350px;">
  <div class="form-group">
    <label for="InputComapny">Comapny</label>
    <InputTextArea @bind-Value="DocumentModel.Company" type="text" class="form-control" id="InputComapny" placeholder="Comapny Name" rows="1" >@DocumentModel.Company</InputTextArea>
    <ValidationMessage For="@(()=>DocumentModel.Company)"/>
  </div>
  <div class="form-group">
    <label for="InputDate">Date</label>
    <InputDate @bind-Value="DocumentModel.Date" class="form-control"/>
    <ValidationMessage For="@(()=>DocumentModel.Date)"/>
  </div>
  <div class="form-group">
      <br/>
    <table>
        <tbody>
            @foreach (var item in DocumentModel.Items)
            {
                <tr scope="row"><td>@item.Name</td><td style="width: 250px;"></td>
                <td><button @onclick="(() => RemoveItem(item))" type="button" class="btn btn-danger btn-sm">Delete</button></td></tr>
            }
            <tr><td><input @bind-value="@AddText" /></td><td style="width: 50px;"/><td><button @onclick="@AddItem" type="button" class="btn btn-primary btn-sm" style="width: 60px;">Add</button></td></tr>
        </tbody>
    </table>
  </div>
  <div class="form-group">
    <InputFile OnChange="@OnInputFileChange" />
  </div>
  <div class="form-group">
  <br />
    <button type="button" class="btn btn-primary" style="float: right;">Update</button>
  </div>
</div>
</EditForm>

@code
{
    [CascadingParameter] 
    BlazoredModalInstance ModalInstance { get; set; }
    [Parameter]
    public DocumentDTO DocumentModel { get; set; } = new();
    public string AddText { get; set; }
    public string file { get; set; }
    //protected override void OnInitialized()
    //{
    //    DocumentModel = _documentService.Get(DocumentModel.PkDocumentId);
    //}
    private async Task<bool> OnInputFileChange(InputFileChangeEventArgs e)
    {
        IBrowserFile file = e.File;
        var fileStream = file.OpenReadStream(file.Size);
        byte[] bytes = new byte[file.Size];
        DocumentModel.DOC = BitConverter.GetBytes(fileStream.ReadAsync(bytes,0,(int)file.Size));
        fileStream.Close();
        //imgUrls.Add(imgUrl);
        //var buffers = new byte[file.Size];
        //await file.OpenReadStream(file.Size).ReadAsync(buffers);
        //string imageType = file.ContentType;
        //string imgUrl = $"data:{imageType};base64,{Convert.ToBase64String(buffers)}";
        ////imgUrls.Add(imgUrl);
    }
    public void AddItem()
    {
        Item item = new Item(AddText,DocumentModel.PkDocumentId);
        DocumentModel.Items.Add(item);
    }
    public void RemoveItem(Item item)
    {
        DocumentModel.Items.Remove(item);
    }
    public void Update()
    { }
}
